# preact-charts
⚛️ preact based charting library. Written with d3-maths, and TypeScript!

[![npm](https://img.shields.io/npm/v/preact-charts.svg)](https://www.npmjs.com/package/preact-charts)

The below documentation will include some TypeScript syntax. If you are new to TypeScript or don't use it, optional props are declared with a `?:`

## Current Charts
### Difference Chart
**Props:**
```typescript
interface DiffBarProps {
    name: string;
    data: Array<{name: string, value: number}>;
    height?: number;
    width?: number;
    margin?: Margin;
    ticks?: number;
}
```
Will display a vertical bar chart with a y-axis that is centered at 0 on the x-axis.

### Grouped Bar Chart
**Props:**
```typescript
interface GroupedBarProps {
    name: string;
    data: GroupedDataObject;
    groups: string[];
    legendReference: {[key: string]: string};
    height?: number;
    width?: number;
    margin?: Margin;
    ticks?: number;
}
```
Where:
```typescript
interface GroupedDataObject {
    [key: string]: Array<{name: number | string, value: number}>;
}
```
Prop `legendReference` is an object where the keys are the same as the keys of the input data. The value is what will be displayed on the chart legend.

### Horizontal Bar Chart
**Props:**
```typescript
interface HorizontalBarProps {
    name: string;
    data: GroupedDataObject;
    groups: string[];
    legendReference: {[key: string]: string};

    height?: number;
    width?: number;
    margin?: Margin;
    ticks?: number;
}
```
This chart is the same as the GroupedBar, but is displayed with horizontal bars.

### Histogram
**Props:**
```typescript
interface HistogramProps {
    name: string;
    x: string;
    data: DataArray;
    height?: number;
    width?: number;
    margin?: Margin;
    ticks?: number;
}
```
`x` should be a key in `data`. Will display a histogram of the data with that key.

### LineScatter
**Props:**
```typescript
interface LineScatterProps {
    name: string;
    x: string;
    y: string;
    data: DataArray[];
    height?: number;
    width?: number;
    margin?: Margin;
    radius?: number;
    labels?: boolean;
    legendReference?: string[];
}
```
Input data is an array of data arrays. Each inner array will be displayed as a group of dots connected by a line.
`legendReference` is an array where `legendReference[index] === data[index]`. The index of legendReference relate to the index of the data.

### ScatterPlot
**Props:**
```typescript
interface ScatterPlotProps {
    name: string;
    x: string;
    y: string;
    data: DataArray;
    height?: number;
    width?: number;
    margin?: Margin;
    radius?: number;
    labels?: boolean;
}
```
The radius of the displayed circles can be changed. `labels` is a boolean determining if axis labels should be presented.

### RangeChart
**Props:**
```typescript
interface RangeChartProps {
    name: string;
    y: string;
    data: TimestampArray;
    height?: number;
    width?: number;
    margin?: Margin;
    lineColour?: string;
    fillColour?: string;
    onBrush?: (extent: Date[]) => void;
}
```
Input data requires a key called `timestamp` which is a parsed date. `onBrush` is called when the chart has been brushed.
This allows for data filtering based on returned time extents. `onBrush` gets the argument of extent which is an array of length 2, which is `[start, end]`

### TrendChart
**Props:**
```typescript
interface TrendChartProps {
    name: string;
    x: string;
    y: string;
    data: TimestampArray;
    height?: number;
    width?: number;
    margin?: Margin;
    lineColour?: string;
    extent?: Date[];
    tooltip?: boolean;
    axisControl?: boolean;
}
```
Allows you to pass an extent, as generated by the RangeChart onBrush to filter the presented data. Allows choice of x-axis key, which must still be a date.
Line colour is customizable.
Tooltip being on will display a circle with the related data displayed when hovering over the chart. The chosen point is the closet to the current mouse location.
Axis control being `true` will display `plus` and `minus` buttons at the top and bottom of the y-axis. Allowing the users to have control over the y-axis.

TrendChart is also allowed to have `<Flag />` child components, which will be displayed on the chart and can be interacted with.

## Other Components
### Flag
**Props:**
```typescript
interface FlagProps extends EventsData {
    onClick: (flagID: number) => void;
    isClicked: boolean;
}
```
These are the flag props required from the user, the rest are passed through in TrendChart.
onClick is a function when the flag is clicked.
The flags do not manage their own state and should be told when they should stay in the clicked state. Clicked flags will have a green topper.
Flags will be displayed as a rectangle with over the extent of [start, end]

## Types Reference
```typescript
export interface Margin {
    top: number;
    right: number;
    bottom: number;
    left: number;
}

export interface NumberObject {
    [key: string]: number;
}

export type DataArray = NumberObject[];

export interface GroupedDataObject {
    [key: string]: Array<{name: number | string, value: number}>;
}

export interface DataObject {
    [key: string]: number | string | Date;
}

export interface TimestampData extends DataObject {
    timestamp: Date;
}

export type TimestampArray = TimestampData[];

export interface EventsData {
    idx: number;
    event: number;
    start: string | Date;
    end: string | Date;
    type: string;
    sub_type: string | null;
    comment: string | null;
}
```
## Styling
The included css modules use css variables to provide theme support. Below is a list of used variables.
- `--font-color-normal`: Default font colour. Used for axis gridlines, histogram bar outlines, scatter plot labels, tooltip text.
- `--font-size-normal`: Default font size. Used for axis text sizing.
- `--font-size-larger`: Default larger text size. USed for trend chart axis control buttons.
- `--background-color`: Default background colour. Used for scatter plot dot outlines.

## Features
This is a note on some features that are included:

I use resize observer to ensure that the charts will resize on window resize. This requires a browser that implements this feature or a polyfill.
This also means that the charts will always fill their parent container. So placing them in sized divs is important.

Chart names should be unique, they are used for things like chart clipPath IDs.

## Contributing
Please fork and submit pull requests for anything that could be improved. This is my first real repo, I know there has been some oversight as this was created
for my work, so some things may be a bit specific to that environment. Documentation requests are also much appreciated.
